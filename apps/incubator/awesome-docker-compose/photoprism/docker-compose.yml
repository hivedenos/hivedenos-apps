version: '3.9'
services:
  photoprism:
    ## Use photoprism/photoprism:preview for testing preview builds:
    image: photoprism/photoprism:latest
    ## Don't enable automatic restarts until PhotoPrism has been properly configured and tested!
    ## If the service gets stuck in a restart loop, this points to a memory, filesystem, network, or database issue:
    ## https://docs.photoprism.app/getting-started/troubleshooting/#fatal-server-errors
    # restart: unless-stopped
    stop_grace_period: 10s
    depends_on:
      - mariadb
    security_opt:
      - seccomp:unconfined
      - apparmor:unconfined


    ports:
      - 
    ## Before you start the service, please check the following config options (and change them as needed):
    ## https://docs.photoprism.app/getting-started/config-options/
    environment:
      PHOTOPRISM_ADMIN_USER:                  # admin login username
      PHOTOPRISM_ADMIN_PASSWORD:           # initial admin password (8-72 characters)
      PHOTOPRISM_AUTH_MODE:                # authentication mode (public, password)
      PHOTOPRISM_SITE_URL: 
      PHOTOPRISM_DISABLE_TLS:                 # disables HTTPS/TLS even if the site URL starts with https:// and a certificate is available
      PHOTOPRISM_DEFAULT_TLS:                  # defaults to a self-signed HTTPS/TLS certificate if no other certificate is available
      PHOTOPRISM_ORIGINALS_LIMIT: 5000               # file size limit for originals in MB (increase for high-res video)
      PHOTOPRISM_HTTP_COMPRESSION:             # improves transfer speed and bandwidth utilization (none or gzip)
      PHOTOPRISM_LOG_LEVEL:                    # log level: trace, debug, info, warning, error, fatal, or panic
      PHOTOPRISM_READONLY:                    # do not modify originals directory (reduced functionality)
      PHOTOPRISM_EXPERIMENTAL:                # enables experimental features
      PHOTOPRISM_DISABLE_CHOWN:               # disables updating storage permissions via chmod and chown on startup
      PHOTOPRISM_DISABLE_WEBDAV:              # disables built-in WebDAV server
      PHOTOPRISM_DISABLE_SETTINGS:            # disables settings UI and API
      PHOTOPRISM_DISABLE_TENSORFLOW:          # disables all features depending on TensorFlow
      PHOTOPRISM_DISABLE_FACES:               # disables face detection and recognition (requires TensorFlow)
      PHOTOPRISM_DISABLE_CLASSIFICATION:      # disables image classification (requires TensorFlow)
      PHOTOPRISM_DISABLE_VECTORS:             # disables vector graphics support
      PHOTOPRISM_DISABLE_RAW:                 # disables indexing and conversion of RAW images
      PHOTOPRISM_RAW_PRESETS:                 # enables applying user presets when converting RAW images (reduces performance)
      PHOTOPRISM_SIDECAR_YAML:                 # creates YAML sidecar files to back up picture metadata
      PHOTOPRISM_BACKUP_ALBUMS:                # creates YAML files to back up album metadata
      PHOTOPRISM_BACKUP_DATABASE:              # creates regular backups based on the configured schedule
      PHOTOPRISM_BACKUP_SCHEDULE: 
      PHOTOPRISM_INDEX_SCHEDULE: 
      PHOTOPRISM_AUTO_INDEX: 300                     # delay before automatically indexing files in SECONDS when uploading via WebDAV (-1 to disable)
      PHOTOPRISM_AUTO_IMPORT: -1                     # delay before automatically importing files in SECONDS when uploading via WebDAV (-1 to disable)
      PHOTOPRISM_DETECT_NSFW:                 # automatically flags photos as private that MAY be offensive (requires TensorFlow)
      PHOTOPRISM_UPLOAD_NSFW:                  # allows uploads that MAY be offensive (no effect without TensorFlow)

      PHOTOPRISM_DATABASE_DRIVER:             # MariaDB 10.5.12+ (MySQL successor) offers significantly better performance compared to SQLite
      PHOTOPRISM_DATABASE_SERVER:      # MariaDB database server (hostname:port)
      PHOTOPRISM_DATABASE_NAME:          # MariaDB database schema name
      PHOTOPRISM_DATABASE_USER:          # MariaDB database user name
      PHOTOPRISM_DATABASE_PASSWORD:        # MariaDB database user password
      PHOTOPRISM_SITE_CAPTION: 
      PHOTOPRISM_SITE_DESCRIPTION:                 # meta site description
      PHOTOPRISM_SITE_AUTHOR:                      # meta site author
      ## Video Transcoding (https://docs.photoprism.app/getting-started/advanced/transcoding/):



      ## Run/install on first startup (options: update https gpu ffmpeg tensorflow davfs clitools clean):

      ## Run as a non-root user after initialization (supported: 0, 33, 50-99, 500-600, and 900-1200):
      # PHOTOPRISM_UID: 1000
      # PHOTOPRISM_GID: 1000
      # PHOTOPRISM_UMASK: 0000
    ## Start as non-root user before initialization (supported: 0, 33, 50-99, 500-600, and 900-1200):

    ## Share hardware devices with FFmpeg and TensorFlow (optional):
    # devices:








    working_dir:  # do not change or remove

    volumes:

      -                # Original media files (DO NOT REMOVE)


      -                   # *Writable* storage folder for cache, database, and sidecar files (DO NOT REMOVE)
 
  ## MariaDB Database Server (recommended)
  ## see https://docs.photoprism.app/getting-started/faq/#should-i-use-sqlite-mariadb-or-mysql
  mariadb:
    image: mariadb:11
    ## If MariaDB gets stuck in a restart loop, this points to a memory or filesystem issue:
    ## https://docs.photoprism.app/getting-started/troubleshooting/#fatal-server-errors
    restart: unless-stopped
    stop_grace_period: 5s
    security_opt: # see https://github.com/MariaDB/mariadb-docker/issues/434#issuecomment-1136151239
      - seccomp:unconfined
      - apparmor:unconfined
    command: --innodb-buffer-pool-size=512M --transaction-isolation=READ-COMMITTED --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci --max-connections=512 --innodb-rollback-on-timeout=OFF --innodb-lock-wait-timeout=120
    ## Never store database files on an unreliable device such as a USB flash drive, an SD card, or a shared network folder:
    volumes:
      -  # DO NOT REMOVE
    environment:
      MARIADB_AUTO_UPGRADE: 
      MARIADB_INITDB_SKIP_TZINFO: 
      MARIADB_DATABASE: 
      MARIADB_USER: 
      MARIADB_PASSWORD: 
      MARIADB_ROOT_PASSWORD: 
 
  ## Watchtower upgrades services automatically (optional)
  ## see https://docs.photoprism.app/getting-started/updates/#watchtower

  watchtower:
    restart: unless-stopped
    image: containrrr/watchtower
    profiles: []
    environment:
      WATCHTOWER_CLEANUP: 
      WATCHTOWER_POLL_INTERVAL: 7200 # checks for updates every two hours
    volumes:
      - 
      -  # optional, for authentication if you have a Docker Hub account
